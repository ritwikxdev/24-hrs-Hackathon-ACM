<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="description" content="Ayushman Bharat Fraud Detection Agent — AI-powered claims audit platform for PMJAY">
<title>AB-FDA · Ayushman Bharat Fraud Detection Agent</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script>
  const firebaseConfig={apiKey:"AIzaSyDcyrsJWAjXj9nAMsFjTwWqz0g02-HL3vA",authDomain:"ayushman-fraud-detection.firebaseapp.com",projectId:"ayushman-fraud-detection"};
  firebase.initializeApp(firebaseConfig);
  const db=firebase.firestore();
</script>
<link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#F5F7FA;--surf:#fff;--card:#F0F2F6;--edge:#DDE2ED;--edge2:#C8D0E0;--or:#E8420A;--or2:#FF5722;--og:linear-gradient(135deg,#E8420A,#FF5722);--bl:#0043CE;--bl2:#0057F8;--blg:linear-gradient(135deg,#0043CE,#0057F8);--text:#1A2540;--mu:#6B7A99;--mu2:#9AA5BE;--green:#059669;--amber:#D97706;--red:#DC2626;--cyan:#0284C7;--sh:0 4px 24px rgba(0,0,0,.08);--sh2:0 20px 60px rgba(0,0,0,.14);--r:14px;--mono:'JetBrains Mono',monospace;--tr:all .22s cubic-bezier(.22,1,.36,1)}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;overflow-x:hidden}
.ann{background:var(--blg);color:#fff;text-align:center;padding:9px 20px;font-size:.72rem;font-weight:500;letter-spacing:.01em}
.ann a{color:#7DD3FC;font-weight:700;margin-left:8px;text-decoration:none}
nav{display:flex;align-items:center;justify-content:space-between;padding:0 48px;height:68px;background:rgba(255,255,255,.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--edge);position:sticky;top:0;z-index:150;box-shadow:0 2px 20px rgba(0,0,0,.05)}
.nlogo{display:flex;align-items:center;gap:12px;text-decoration:none;cursor:pointer}
.nmark{width:38px;height:38px;background:var(--og);border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Epilogue',sans-serif;font-weight:900;font-size:13px;color:#fff;box-shadow:0 4px 16px rgba(255,87,34,.4);transition:transform .2s;flex-shrink:0}
.nmark:hover{transform:rotate(-6deg) scale(1.08)}
.nname{font-family:'Epilogue',sans-serif;font-weight:800;font-size:.95rem;color:var(--text);letter-spacing:-.02em}
.nsub{font-size:.58rem;color:var(--mu);letter-spacing:.1em;text-transform:uppercase}
.nlinks{display:flex;align-items:center;gap:28px}
.nlinks a{font-size:.82rem;font-weight:500;color:var(--mu);text-decoration:none;transition:color .18s}
.nlinks a:hover,.nlinks a.na{color:var(--bl);font-weight:600}
.nright{display:flex;align-items:center;gap:12px}
.clockn{font-family:var(--mono);font-size:.68rem;color:var(--mu);background:var(--card);border:1px solid var(--edge);padding:5px 12px;border-radius:7px}
.ldot{display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--green);animation:pu 2s infinite;margin-right:6px}
@keyframes pu{0%,100%{box-shadow:0 0 0 0 rgba(5,150,105,.5)}50%{box-shadow:0 0 0 6px transparent}}
.cbtn{background:var(--blg);color:#fff;border:none;padding:10px 22px;border-radius:9px;font-family:'Epilogue',sans-serif;font-weight:700;font-size:.8rem;cursor:pointer;box-shadow:0 4px 16px rgba(0,67,206,.3);transition:var(--tr);text-decoration:none}
.cbtn:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,67,206,.45)}
.hero{background:linear-gradient(135deg,#F5F7FA,#EEF2FF 50%,#F0F7FF);padding:92px 48px 80px;display:grid;grid-template-columns:1fr 1fr;gap:60px;align-items:center;position:relative;overflow:hidden;min-height:600px}
.hero::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(200,208,224,.3) 1px,transparent 1px),linear-gradient(90deg,rgba(200,208,224,.3) 1px,transparent 1px);background-size:48px 48px;pointer-events:none}
.hlabel{display:inline-flex;align-items:center;gap:8px;background:rgba(0,67,206,.08);border:1px solid rgba(0,67,206,.2);border-radius:999px;padding:5px 16px;font-size:.65rem;font-weight:700;color:var(--bl);letter-spacing:.12em;text-transform:uppercase;margin-bottom:22px}
.hh1{font-family:'Epilogue',sans-serif;font-size:3.1rem;font-weight:900;line-height:1.05;letter-spacing:-.04em;color:var(--text);margin-bottom:22px}
.hh1 em{background:var(--og);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-style:normal}
.hp{font-size:.98rem;line-height:1.78;color:var(--mu);max-width:480px;margin-bottom:38px}
.hbtns{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
.bprim{background:var(--og);color:#fff;border:none;padding:14px 30px;border-radius:10px;font-family:'Epilogue',sans-serif;font-weight:700;font-size:.9rem;cursor:pointer;box-shadow:0 6px 24px rgba(255,87,34,.4);transition:var(--tr);text-decoration:none;display:inline-flex;align-items:center;gap:8px}
.bprim:hover{transform:translateY(-3px);box-shadow:0 12px 36px rgba(255,87,34,.55)}
.bout{background:transparent;color:var(--text);border:1.5px solid var(--edge2);padding:14px 28px;border-radius:10px;font-family:'Epilogue',sans-serif;font-weight:600;font-size:.9rem;cursor:pointer;transition:var(--tr);text-decoration:none;display:inline-flex;align-items:center;gap:8px}
.bout:hover{border-color:var(--bl);color:var(--bl);background:rgba(0,67,206,.05)}
.hbadges{display:flex;gap:10px;margin-top:28px;flex-wrap:wrap}
.hbdg{background:#fff;border:1px solid var(--edge);border-radius:8px;padding:7px 14px;font-size:.68rem;font-weight:600;color:var(--mu);display:flex;align-items:center;gap:6px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.hgfx{display:flex;align-items:center;justify-content:center}
.netwrap{width:100%;max-width:460px;border-radius:24px;background:linear-gradient(135deg,#fff,#EEF2FF);border:1px solid rgba(0,67,206,.12);box-shadow:0 20px 60px rgba(0,67,206,.1),0 4px 20px rgba(0,0,0,.05);padding:32px;animation:flt 6s ease-in-out infinite}
@keyframes flt{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
.nnodes{position:relative;height:280px}
.nd{position:absolute;display:flex;align-items:center;justify-content:center;border-radius:50%;animation:np 3.5s ease-in-out infinite}
@keyframes np{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
.nd-c{width:76px;height:76px;background:var(--blg);top:50%;left:50%;margin:-38px 0 0 -38px;box-shadow:0 8px 32px rgba(0,67,206,.45);z-index:10;color:#fff;font-family:'Epilogue',sans-serif;font-size:.5rem;font-weight:800;flex-direction:column;gap:2px}
.nd-c big{font-size:1.6rem}
.nd-s{width:50px;height:50px;background:#fff;border:1.5px solid var(--edge);box-shadow:0 4px 16px rgba(0,0,0,.07);font-size:1.3rem}
.n1{top:6%;left:12%;animation-delay:.3s}.n2{top:6%;right:12%;animation-delay:.6s}.n3{top:44%;right:2%;animation-delay:.9s}
.n4{bottom:6%;right:18%;animation-delay:1.2s}.n5{bottom:6%;left:18%;animation-delay:1.5s}.n6{top:44%;left:2%;animation-delay:1.8s}
.nsvg{position:absolute;inset:0;width:100%;height:100%;pointer-events:none;overflow:visible}
.nline{stroke:rgba(0,67,206,.15);stroke-width:1.5;stroke-dasharray:6 4;animation:da 3s linear infinite;fill:none}
@keyframes da{to{stroke-dashoffset:-20}}
.nstats{display:flex;gap:12px;margin-top:20px}
.nst{flex:1;background:#fff;border:1px solid var(--edge);border-radius:10px;padding:12px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.04)}
.nstv{font-family:'Epilogue',sans-serif;font-size:1.3rem;font-weight:900;color:var(--bl);line-height:1}
.nstl{font-size:.58rem;color:var(--mu);text-transform:uppercase;letter-spacing:.08em;margin-top:3px}
.stats{background:linear-gradient(135deg,#0A1628,#0D1F3C);padding:72px 48px;text-align:center}
.stats h2{font-family:'Epilogue',sans-serif;font-size:2rem;font-weight:900;color:#fff;letter-spacing:-.03em;margin-bottom:8px}
.stats .sp{font-size:.9rem;color:rgba(255,255,255,.45);margin-bottom:52px;display:block}
.sgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:24px;max-width:1100px;margin:0 auto}
.sc{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:32px 24px;position:relative;overflow:hidden;transition:var(--tr);cursor:default}
.sc::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:2px 0 0 2px}
.sc-o::before{background:var(--og)}.sc-g::before{background:linear-gradient(180deg,#059669,#00F5AA)}
.sc-b::before{background:var(--blg)}.sc-a::before{background:linear-gradient(180deg,#D97706,#FFD046)}
.sc:hover{transform:translateY(-6px);background:rgba(255,255,255,.1)}
.scn{font-family:'Epilogue',sans-serif;font-size:2.8rem;font-weight:900;line-height:1;margin-bottom:8px;letter-spacing:-.03em}
.sc-o .scn{color:#FF7043}.sc-g .scn{color:#34D399}.sc-b .scn{color:#60A5FA}.sc-a .scn{color:#FCD34D}
.scl{font-size:.78rem;color:rgba(255,255,255,.5);line-height:1.5}
.fraud{padding:80px 48px;background:#fff}
.shdr{text-align:center;margin-bottom:52px}
.stag{display:inline-block;border-radius:999px;padding:5px 16px;font-size:.65rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;margin-bottom:14px}
.stag-r{background:rgba(220,38,38,.08);border:1px solid rgba(220,38,38,.2);color:var(--red)}
.stag-b{background:rgba(0,67,206,.08);border:1px solid rgba(0,67,206,.2);color:var(--bl)}
.stag-o{background:rgba(232,66,10,.08);border:1px solid rgba(232,66,10,.2);color:var(--or2)}
.sh2{font-family:'Epilogue',sans-serif;font-size:2.2rem;font-weight:900;letter-spacing:-.03em;color:var(--text);margin-bottom:12px}
.spp{font-size:.92rem;color:var(--mu);max-width:560px;margin:0 auto;line-height:1.7}
.fgrid2{display:grid;grid-template-columns:repeat(3,1fr);gap:24px;max-width:1100px;margin:0 auto}
.fc{background:#F8F9FC;border:1.5px solid var(--edge);border-radius:18px;padding:32px 28px;transition:var(--tr)}
.fc:hover{transform:translateY(-6px);box-shadow:var(--sh2);border-color:var(--edge2)}
.fico{width:54px;height:54px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:26px;margin-bottom:20px}
.fi-r{background:rgba(220,38,38,.1)}.fi-c{background:rgba(2,132,199,.1)}.fi-a{background:rgba(217,119,6,.1)}
.fc h3{font-family:'Epilogue',sans-serif;font-weight:800;font-size:1.05rem;margin-bottom:10px;color:var(--text)}
.fc>.fcp{font-size:.82rem;color:var(--mu);line-height:1.8;margin-bottom:16px}
.ftag2{display:inline-flex;align-items:center;gap:6px;font-size:.66rem;font-weight:700;padding:4px 12px;border-radius:999px;letter-spacing:.06em}
.ftag2-r{background:rgba(220,38,38,.1);color:var(--red);border:1px solid rgba(220,38,38,.2)}
.ftag2-c{background:rgba(2,132,199,.1);color:var(--cyan);border:1px solid rgba(2,132,199,.2)}
.ftag2-a{background:rgba(217,119,6,.1);color:var(--amber);border:1px solid rgba(217,119,6,.2)}
.fdtl{margin-top:18px;padding-top:18px;border-top:1px solid var(--edge)}
.fdtl p{font-size:.76rem;color:var(--mu2);line-height:1.7}
.plat{padding:80px 48px;background:#EEF1F6}
.tabbar{display:flex;background:#fff;border:1px solid var(--edge);border-radius:12px;overflow:hidden;max-width:740px;margin:0 auto 48px}
.tbb{flex:1;padding:14px 10px;background:transparent;border:none;border-bottom:3px solid transparent;font-family:'Inter',sans-serif;font-size:.82rem;font-weight:500;color:var(--mu);cursor:pointer;transition:var(--tr)}
.tbb.act{color:var(--bl);border-bottom-color:var(--bl);background:rgba(0,67,206,.03);font-weight:600}
.tbc{display:none;grid-template-columns:1fr 1fr;gap:52px;align-items:center;max-width:1100px;margin:0 auto;animation:fu .4s ease}
.tbc.act{display:grid}
@keyframes fu{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.tibx{background:#fff;border:1px solid var(--edge);border-radius:20px;padding:40px;display:flex;align-items:center;justify-content:center;font-size:5rem;box-shadow:var(--sh);min-height:250px}
.ttxt h3{font-family:'Epilogue',sans-serif;font-weight:900;font-size:1.55rem;letter-spacing:-.03em;color:var(--text);margin-bottom:12px;line-height:1.2}
.ttxt p{font-size:.88rem;color:var(--mu);line-height:1.8;margin-bottom:24px}
.tlist{list-style:none;display:flex;flex-direction:column;gap:12px}
.tlist li{display:flex;align-items:flex-start;gap:12px;font-size:.83rem;color:var(--text);line-height:1.6}
.tlist li::before{content:'✓';width:20px;height:20px;min-width:20px;background:rgba(5,150,105,.12);color:var(--green);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.65rem;font-weight:800;margin-top:1px}
.how{padding:80px 48px;background:#fff}
.howgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:28px;max-width:1100px;margin:0 auto;position:relative}
.howgrid::before{content:'';position:absolute;top:36px;left:12.5%;right:12.5%;height:1.5px;background:linear-gradient(90deg,rgba(0,67,206,.2),rgba(0,67,206,.06));z-index:0}
.step{background:#F8F9FC;border:1.5px solid var(--edge);border-radius:18px;padding:28px 22px;text-align:center;position:relative;z-index:1;transition:var(--tr)}
.step:hover{transform:translateY(-6px);box-shadow:var(--sh);border-color:rgba(0,67,206,.2)}
.stepn{width:48px;height:48px;border-radius:50%;background:var(--blg);color:#fff;font-family:'Epilogue',sans-serif;font-weight:900;font-size:1.1rem;display:flex;align-items:center;justify-content:center;margin:0 auto 14px;box-shadow:0 4px 14px rgba(0,67,206,.3)}
.stepi{font-size:2.2rem;margin-bottom:12px;display:block}
.step h4{font-family:'Epilogue',sans-serif;font-weight:800;font-size:.95rem;color:var(--text);margin-bottom:8px}
.step p{font-size:.76rem;color:var(--mu);line-height:1.7}
#dashboard{background:#F5F7FA}
.dashi{text-align:center;padding:60px 48px 40px}
.dashbar{display:flex;align-items:center;justify-content:space-between;padding:0 40px;height:60px;background:rgba(255,255,255,.96);border-bottom:1px solid var(--edge);border-top:1px solid var(--edge)}
.dashbar-l{display:flex;align-items:center;gap:14px}
.dashbar-r{display:flex;align-items:center;gap:10px}
.lpill{display:flex;align-items:center;gap:7px;background:rgba(0,214,143,.1);border:1px solid rgba(0,214,143,.25);border-radius:999px;padding:5px 14px;font-size:.68rem;font-weight:600;letter-spacing:.08em;color:var(--green);text-transform:uppercase}
.dwrap{padding:28px 40px 72px;max-width:1560px;margin:0 auto}
.prog-rail{position:fixed;top:0;left:0;width:100%;height:3px;z-index:999}
.prog-fill{height:100%;background:var(--og);width:0%;transition:width .4s ease;box-shadow:0 0 12px rgba(255,87,34,.7)}
.kpi-grid{display:grid;grid-template-columns:repeat(1fr);gap:16px;margin-bottom:24px}
@media(max-width:1100px){
  .kpi-grid{grid-template-columns:1fr 1fr}
}

.kpi{background:#fff;border:1px solid var(--edge);border-radius:var(--r);padding:22px 24px;position:relative;overflow:hidden;transition:var(--tr);animation:fu .6s ease both;cursor:default}
.kpi:hover{transform:translateY(-5px);box-shadow:var(--sh)}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.ko::before{background:var(--og)}.kr::before{background:linear-gradient(90deg,var(--red),#FF6B8A)}
.ky::before{background:linear-gradient(90deg,var(--amber),#FFD046)}.kg::before{background:linear-gradient(90deg,var(--green),#00F5AA)}
.kpi-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;margin-bottom:14px}
.ko .kpi-icon{background:rgba(255,87,34,.12)}.kr .kpi-icon{background:rgba(255,61,107,.12)}
.ky .kpi-icon{background:rgba(255,184,0,.12)}.kg .kpi-icon{background:rgba(0,214,143,.12)}
.kpi-lbl{font-size:.65rem;color:var(--mu);font-weight:600;text-transform:uppercase;letter-spacing:.12em;margin-bottom:6px}
.kpi-val{font-family:'Epilogue',sans-serif;font-size:2.5rem;font-weight:900;line-height:1;letter-spacing:-.03em}
.ko .kpi-val{color:var(--or2)}.kr .kpi-val{color:var(--red)}.ky .kpi-val{color:var(--amber)}.kg .kpi-val{color:var(--green)}
.kpi-sub{font-size:.69rem;color:var(--mu);margin-top:8px;display:flex;align-items:center;gap:5px}
.kpi-sub-dot{width:5px;height:5px;border-radius:50%;background:currentColor;opacity:.5}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
.g3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:18px;margin-bottom:18px}
.card{background:#fff;border:1px solid var(--edge);border-radius:var(--r);padding:24px 26px;animation:fu .6s ease both;transition:border-color .2s;position:relative;overflow:hidden}
.card:hover{border-color:var(--edge2)}
.card-glow{position:absolute;top:-60px;right:-60px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(255,87,34,.06),transparent 70%);pointer-events:none}
.card-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.card-title{font-family:'Epilogue',sans-serif;font-weight:800;font-size:.88rem;color:var(--text)}
.cbadge{font-size:.6rem;font-weight:700;letter-spacing:.08em;padding:3px 10px;border-radius:999px;text-transform:uppercase}
.cb-o{background:rgba(255,87,34,.14);color:var(--or2);border:1px solid rgba(255,87,34,.22)}
.cb-r{background:rgba(255,61,107,.12);color:var(--red);border:1px solid rgba(255,61,107,.2)}
.cb-g{background:rgba(0,214,143,.1);color:var(--green);border:1px solid rgba(0,214,143,.18)}
.cb-a{background:rgba(255,184,0,.1);color:var(--amber);border:1px solid rgba(255,184,0,.2)}
.cb-c{background:rgba(0,200,255,.1);color:var(--cyan);border:1px solid rgba(0,200,255,.18)}
canvas{max-height:230px}
.anom-rows{display:flex;flex-direction:column;gap:16px}
.arow{display:flex;align-items:center;gap:12px}
.arow-lbl{font-size:.76rem;font-weight:500;color:var(--text);min-width:128px}
.arow-track{flex:1;height:8px;background:var(--edge);border-radius:99px;overflow:hidden}
.arow-fill{height:100%;border-radius:99px;transition:width 1.1s cubic-bezier(.22,1,.36,1)}
.af-upc{background:linear-gradient(90deg,var(--red),#FF6B8A)}.af-ghost{background:linear-gradient(90deg,var(--cyan),#60DCFF)}
.af-dup{background:linear-gradient(90deg,var(--amber),#FFD046)}.af-avg{background:linear-gradient(90deg,var(--green),#00F5AA)}
.arow-count{font-family:'Epilogue',sans-serif;font-size:.82rem;font-weight:800;min-width:28px;text-align:right}
.ml-block{margin-top:18px;padding-top:16px;border-top:1px solid var(--edge);display:flex;align-items:center;gap:16px}
.ml-score{font-family:'Epilogue',sans-serif;font-size:2.2rem;font-weight:900;color:var(--green)}
.ml-lbl{font-size:.62rem;color:var(--mu);text-transform:uppercase;letter-spacing:.1em}
.ml-sub{font-size:.68rem;color:var(--mu2)}
.hosp-list{display:flex;flex-direction:column;gap:8px}
.hosp-item{display:flex;align-items:center;gap:10px;padding:11px 13px;background:var(--card);border:1px solid var(--edge);border-radius:10px;cursor:pointer;transition:var(--tr);position:relative;overflow:hidden}
.hosp-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
.hosp-item:hover{border-color:var(--edge2);transform:translateX(4px);box-shadow:var(--sh)}
.hi-high::before{background:var(--red)}.hi-med::before{background:var(--amber)}.hi-low::before{background:var(--green)}
.hosp-rank{font-size:.62rem;color:var(--mu2);min-width:18px;font-weight:600}
.hosp-name{flex:1;font-size:.78rem;font-weight:500}
.hosp-score{font-family:'Epilogue',sans-serif;font-size:1.15rem;font-weight:900}
.hs-high{color:var(--red)}.hs-med{color:var(--amber)}.hs-low{color:var(--green)}
.ai-panel{background:linear-gradient(135deg,rgba(232,66,10,.04),#fff 60%);border:1px solid rgba(232,66,10,.18);border-radius:var(--r);padding:26px;margin-bottom:18px;animation:fu .6s ease .15s both;position:relative;overflow:hidden}
.ai-panel::before{content:'';position:absolute;top:-80px;right:-80px;width:250px;height:250px;border-radius:50%;background:radial-gradient(circle,rgba(255,87,34,.08),transparent 60%);pointer-events:none}
.ai-hdr{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.ai-chip{display:flex;align-items:center;gap:7px;background:rgba(255,87,34,.12);border:1px solid rgba(255,87,34,.25);border-radius:999px;padding:5px 14px;font-size:.65rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--or2)}
.ai-chip-dot{width:6px;height:6px;border-radius:50%;background:var(--or);animation:pu 2s infinite}
.ai-title{font-family:'Epilogue',sans-serif;font-weight:800;font-size:1rem;color:var(--text)}
.report-block{background:var(--card);border:1px solid var(--edge);border-radius:10px;padding:18px 20px;font-size:.84rem;line-height:1.9;color:rgba(26,37,64,.72);min-height:110px;position:relative}
.report-block.typing::after{content:'▋';color:var(--or);animation:bk .7s step-end infinite}
@keyframes bk{50%{opacity:0}}
.ai-meta{display:flex;gap:20px;flex-wrap:wrap;margin-top:12px;font-size:.71rem;color:var(--mu)}
.ai-meta strong{color:var(--text)}
.alert-banner{display:flex;align-items:center;gap:16px;background:rgba(220,38,38,.06);border:1px solid rgba(220,38,38,.2);border-left:3px solid var(--red);border-radius:var(--r);padding:16px 22px;margin-bottom:28px}
.alert-icon{font-size:22px;flex-shrink:0}
.alert-body{flex:1;font-size:.83rem;line-height:1.65;color:rgba(26,37,64,.75)}
.alert-body strong{color:var(--red)}
.alert-right{text-align:center;flex-shrink:0}
.alert-num{font-family:'Epilogue',sans-serif;font-size:2.4rem;font-weight:900;color:var(--red);line-height:1}
.alert-num-lbl{font-size:.6rem;color:var(--mu);letter-spacing:.14em;text-transform:uppercase}
.filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:18px;align-items:center}
.flt{padding:6px 16px;border-radius:999px;border:1px solid var(--edge2);background:transparent;color:var(--mu);font-size:.72rem;font-weight:500;cursor:pointer;transition:var(--tr);font-family:'Inter',sans-serif}
.flt:hover{border-color:var(--or);color:var(--or2)}
.flt.fa{border-color:var(--or2);color:var(--or2);background:rgba(255,87,34,.1)}
.flt.fr{border-color:var(--red);color:var(--red);background:rgba(255,61,107,.08)}
.flt.fw{border-color:var(--amber);color:var(--amber);background:rgba(255,184,0,.08)}
.flt.fg{border-color:var(--green);color:var(--green);background:rgba(0,214,143,.08)}
.search-box{position:relative;margin-left:auto}
.search-box input{font-family:'Inter',sans-serif;font-size:.8rem;background:var(--card);border:1px solid var(--edge2);border-radius:9px;padding:8px 14px 8px 36px;color:var(--text);outline:none;width:210px;transition:var(--tr)}
.search-box input::placeholder{color:var(--mu2)}
.search-box input:focus{border-color:var(--or);box-shadow:0 0 0 3px rgba(255,87,34,.15)}
.search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:13px;color:var(--mu);pointer-events:none}
.tbl-wrap{overflow-x:auto;border-radius:0 0 var(--r) var(--r)}
table{width:100%;border-collapse:collapse;font-size:.8rem}
thead{position:sticky;top:68px;z-index:10}
thead th{font-size:.59rem;font-weight:700;text-transform:uppercase;letter-spacing:.13em;color:var(--mu);text-align:left;padding:12px 15px;border-bottom:1px solid var(--edge);background:#EEF1F6;cursor:pointer;user-select:none;white-space:nowrap;transition:color .15s}
thead th:hover{color:var(--or2)}
thead th.sa::after{content:' ↑';color:var(--or)}thead th.sd::after{content:' ↓';color:var(--or)}
tbody tr{border-bottom:1px solid rgba(200,208,224,.7);transition:background .12s;cursor:pointer;animation:fu .35s ease both}
tbody tr:hover{background:rgba(232,66,10,.04)}
tbody tr:hover .td-id{color:var(--or)}
td{padding:12px 15px;color:var(--text);vertical-align:middle}
.td-id{font-family:var(--mono);font-size:.74rem;font-weight:500;color:var(--or2);letter-spacing:.01em}
.risk{display:inline-flex;align-items:center;gap:4px;font-size:.6rem;font-weight:700;letter-spacing:.05em;padding:3px 10px;border-radius:999px;text-transform:uppercase}
.rH{background:rgba(255,61,107,.14);color:var(--red);border:1px solid rgba(255,61,107,.25)}
.rM{background:rgba(255,184,0,.12);color:var(--amber);border:1px solid rgba(255,184,0,.22)}
.rL{background:rgba(0,214,143,.1);color:var(--green);border:1px solid rgba(0,214,143,.2)}
.ftag{display:inline-flex;align-items:center;gap:4px;font-size:.68rem;font-weight:500;padding:2px 9px;border-radius:6px}
.ft-upc{background:rgba(255,61,107,.12);color:var(--red)}.ft-ghost{background:rgba(0,200,255,.1);color:var(--cyan)}
.ft-dup{background:rgba(255,184,0,.1);color:var(--amber)}.ft-clean{background:rgba(0,214,143,.1);color:var(--green)}
.sc-wrap{display:flex;align-items:center;gap:8px}
.sc-track{width:60px;height:6px;background:var(--edge);border-radius:99px;overflow:hidden}
.sc-fill{height:100%;border-radius:99px;transition:width .8s ease}
.sc-num{font-family:'Epilogue',sans-serif;font-size:.76rem;font-weight:800;min-width:24px}
.dtl-btn{background:rgba(255,87,34,.1);border:1px solid rgba(255,87,34,.25);color:var(--or2);padding:4px 13px;border-radius:7px;font-size:.68rem;font-weight:600;cursor:pointer;font-family:'Epilogue',sans-serif;transition:var(--tr)}
.dtl-btn:hover{background:var(--or);color:#fff;border-color:var(--or)}
.export-btn{display:flex;align-items:center;gap:6px;background:transparent;border:1px solid var(--edge2);color:var(--mu);cursor:pointer;padding:8px 14px;border-radius:9px;font-family:'Inter',sans-serif;font-size:.75rem;font-weight:500;transition:var(--tr)}
.export-btn:hover{border-color:var(--or);color:var(--or2);background:rgba(255,87,34,.06)}
.run-btn{display:flex;align-items:center;gap:8px;background:var(--og);color:#fff;border:none;cursor:pointer;padding:10px 22px;border-radius:9px;font-family:'Epilogue',sans-serif;font-weight:700;font-size:.82rem;box-shadow:0 4px 18px rgba(255,87,34,.4);transition:var(--tr)}
.run-btn:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(255,87,34,.55)}
.run-btn.running{background:linear-gradient(135deg,#FFB800,#FF9800);pointer-events:none}
.run-spin{width:13px;height:13px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spinit .7s linear infinite;display:none}
.run-btn.running .run-spin{display:block}.run-btn.running .run-arrow{display:none}
@keyframes spinit{to{transform:rotate(360deg)}}
.section-lbl{font-family:'Epilogue',sans-serif;font-size:.63rem;font-weight:700;color:var(--or2);letter-spacing:.16em;text-transform:uppercase;display:flex;align-items:center;gap:12px;margin-bottom:16px}
.section-lbl::before{content:'';width:3px;height:14px;background:var(--og);border-radius:2px;flex-shrink:0}
.section-lbl::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--edge),transparent)}
.modal-ov{display:none;position:fixed;inset:0;z-index:300;background:rgba(26,37,64,.55);backdrop-filter:blur(8px);align-items:center;justify-content:center}
.modal-ov.open{display:flex;animation:fi .2s ease}
@keyframes fi{from{opacity:0}to{opacity:1}}
.modal{background:#fff;border:1px solid rgba(232,66,10,.15);border-radius:18px;padding:32px;max-width:560px;width:92%;box-shadow:var(--sh2);animation:mi .32s cubic-bezier(.22,1,.36,1);position:relative}
@keyframes mi{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-close{position:absolute;top:18px;right:18px;background:var(--card);border:1px solid var(--edge);width:32px;height:32px;border-radius:8px;color:var(--mu);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.modal-close:hover{background:var(--edge)}
.modal-id{font-family:'Epilogue',sans-serif;font-weight:900;font-size:1.3rem;color:var(--text);margin-bottom:3px;letter-spacing:-.02em}
.modal-hosp{font-size:.78rem;color:var(--mu);margin-bottom:22px}
.m-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:18px}
.mf{background:var(--card);border:1px solid var(--edge);border-radius:10px;padding:13px 15px}
.mf-lbl{font-size:.6rem;color:var(--mu);text-transform:uppercase;letter-spacing:.1em;margin-bottom:5px}
.mf-val{font-size:.88rem;font-weight:600;color:var(--text)}
.mf-o{color:var(--or2)}.mf-r{color:var(--red)}.mf-a{color:var(--amber)}.mf-g{color:var(--green)}.mf-c{color:var(--cyan)}
.modal-reason{background:var(--card);border:1px solid var(--edge);border-left:3px solid var(--or);border-radius:10px;padding:14px 16px;font-size:.8rem;line-height:1.8;color:rgba(26,37,64,.72)}
.modal-reason strong{color:var(--text)}
.toast{position:fixed;bottom:28px;right:28px;z-index:400;background:#fff;border:1px solid var(--edge2);border-left:3px solid var(--or);color:var(--text);font-size:.82rem;font-weight:500;padding:14px 20px;border-radius:12px;box-shadow:var(--sh2);display:flex;align-items:center;gap:9px;transform:translateY(60px);opacity:0;transition:var(--tr);max-width:320px}
.toast.show{transform:translateY(0);opacity:1}
.empty{text-align:center;padding:56px 32px}
.empty-icon{font-size:44px;margin-bottom:14px;opacity:.3}
.empty h3{font-family:'Epilogue',sans-serif;font-size:1.1rem;color:var(--text);margin-bottom:8px}
.empty p{font-size:.78rem;color:var(--mu2)}
.footer{background:#0A1628;color:#fff;padding:60px 48px 0}
.ffgrid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:48px;padding-bottom:48px;border-bottom:1px solid rgba(255,255,255,.08)}
.ffbrand p{font-size:.8rem;color:rgba(255,255,255,.4);line-height:1.8;max-width:260px;margin-top:14px}
.fcol h4{font-family:'Epilogue',sans-serif;font-weight:700;font-size:.75rem;letter-spacing:.08em;text-transform:uppercase;color:rgba(255,255,255,.35);margin-bottom:18px}
.fcol a{display:block;font-size:.82rem;color:rgba(255,255,255,.55);text-decoration:none;margin-bottom:10px;transition:color .18s}
.fcol a:hover{color:#60A5FA}
.fbot{display:flex;align-items:center;justify-content:space-between;padding:20px 0;flex-wrap:wrap;gap:10px}
.fbot p{font-size:.7rem;color:rgba(255,255,255,.28)}
.fbadges{display:flex;gap:10px}
.fbdg{font-size:.58rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase;padding:4px 10px;border-radius:5px;border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.3)}
@media(max-width:1100px){
  .kpi-grid{grid-template-columns:1fr 1fr}.g2,.g3{grid-template-columns:1fr}
  .sgrid{grid-template-columns:1fr 1fr}.howgrid{grid-template-columns:1fr 1fr}
  .fgrid2{grid-template-columns:1fr 1fr}.ffgrid{grid-template-columns:1fr 1fr}
  .hero{grid-template-columns:1fr;text-align:center;min-height:auto;padding:70px 40px 60px}
  .hp{margin:0 auto 36px}.hbtns{justify-content:center}.hbadges{justify-content:center}.hgfx{display:none}
}
@media(max-width:700px){
  nav{padding:0 20px}.nlinks{display:none}
  .hero,.fraud,.plat,.how,.stats,.dashi{padding-left:20px;padding-right:20px}
  .hh1{font-size:2rem}.sgrid,.howgrid{grid-template-columns:1fr 1fr}
  .tbc.act{grid-template-columns:1fr}.tibx{display:none}
  .kpi-grid{grid-template-columns:1fr}.dwrap{padding:16px 16px 48px}.dashbar{padding:0 16px}
  .footer{padding:40px 20px 0}.ffgrid{grid-template-columns:1fr}
}
@media(max-width:480px){.sgrid,.howgrid,.fgrid2{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="prog-rail"><div class="prog-fill" id="progress"></div></div>

<!-- ANNOUNCE BAR -->
<div class="ann">🛡️ Ayushman Bharat PMJAY · AI-Powered Fraud Prevention Platform &nbsp;|&nbsp; Protecting ₹0.5L+ Crore in Healthcare Claims<a href="#dashboard">View Live Dashboard →</a></div>

<!-- NAV -->
<nav>
  <a class="nlogo" href="#">
    <div class="nmark">AB</div>
    <div><div class="nname">Fraud Detection Agent</div><div class="nsub">Ayushman Bharat · PMJAY</div></div>
  </a>
  <div class="nlinks">
    <a href="#platform">Platform</a>
    <a href="#fraud-types">Fraud Types</a>
    <a href="#how-it-works">How It Works</a>
    <a href="#dashboard" class="na">Live Dashboard</a>
  </div>
  <div class="nright">
    <span class="clockn" id="clock">--:--:-- IST</span>
    <a class="cbtn" href="#dashboard">View Dashboard</a>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div>
    <div class="hlabel">🛡️ AI-Powered · Real-Time · Government-Grade</div>
    <h1 class="hh1">The <em>Fraud Prevention</em><br>Platform for<br>Ayushman Bharat</h1>
    <p class="hp">AB-FDA uses advanced AI and rule-based analytics to detect fraudulent PMJAY healthcare claims in real time — protecting government funds and ensuring benefits reach genuine patients.</p>
    <div class="hbtns">
      <a class="bprim" href="#dashboard">▶ View Live Dashboard</a>
      <a class="bout" href="#how-it-works">How It Works →</a>
    </div>
    <div class="hbadges">
      <span class="hbdg">🏛️ PMJAY Compliant</span>
      <span class="hbdg">🤖 AI Rule Engine</span>
      <span class="hbdg">🔒 Secure &amp; Encrypted</span>
      <span class="hbdg">📊 Real-time Analytics</span>
    </div>
  </div>
  <div class="hgfx">
    <div class="netwrap">
      <div class="nnodes">
        <svg class="nsvg" viewBox="0 0 460 280">
          <line class="nline" x1="230" y1="140" x2="80" y2="37"/>
          <line class="nline" x1="230" y1="140" x2="380" y2="37"/>
          <line class="nline" x1="230" y1="140" x2="445" y2="140"/>
          <line class="nline" x1="230" y1="140" x2="350" y2="243"/>
          <line class="nline" x1="230" y1="140" x2="110" y2="243"/>
          <line class="nline" x1="230" y1="140" x2="15" y2="140"/>
        </svg>
        <div class="nd nd-c" style="animation-delay:0s"><big>🛡️</big>AB-FDA</div>
        <div class="nd nd-s n1">🏥</div>
        <div class="nd nd-s n2">📋</div>
        <div class="nd nd-s n3">👤</div>
        <div class="nd nd-s n4">💊</div>
        <div class="nd nd-s n5">🔍</div>
        <div class="nd nd-s n6">⚠️</div>
      </div>
      <div class="nstats">
        <div class="nst"><div class="nstv">92%</div><div class="nstl">AI Accuracy</div></div>
        <div class="nst"><div class="nstv" style="color:var(--or2)">Real-time</div><div class="nstl">Detection</div></div>
        <div class="nst"><div class="nstv" style="color:var(--green)">PMJAY</div><div class="nstl">Certified</div></div>
      </div>
    </div>
  </div>
</section>

<!-- STATS DARK -->
<section class="stats">
  <h2>Protecting India's Healthcare Ecosystem</h2>
  <span class="sp">Real impact of AI-powered fraud detection on the Ayushman Bharat scheme</span>
  <div class="sgrid">
    <div class="sc sc-o"><div class="scn">₹500Cr+</div><div class="scl">Estimated fraud exposure detected across PMJAY claims</div></div>
    <div class="sc sc-g"><div class="scn">50K+</div><div class="scl">Claims analyzed and audited by the AI engine</div></div>
    <div class="sc sc-b"><div class="scn">500+</div><div class="scl">Hospitals monitored for fraudulent billing patterns</div></div>
    <div class="sc sc-a"><div class="scn">92%</div><div class="scl">AI rule engine detection accuracy on known fraud patterns</div></div>
  </div>
</section>

<!-- FRAUD TYPES -->
<section class="fraud" id="fraud-types">
  <div class="shdr">
    <div class="stag stag-r">⚠️ Fraud Intelligence</div>
    <h2 class="sh2">The Three Major Fraud Patterns We Detect</h2>
    <p class="spp">Our AI engine is trained to identify the most prevalent fraud typologies in India's public healthcare system.</p>
  </div>
  <div class="fgrid2">
    <div class="fc">
      <div class="fico fi-r">🔺</div>
      <h3>Up-coding Fraud</h3>
      <p class="fcp">Hospitals bill procedures at a higher complexity or cost than what was actually performed. A routine consultation is billed as a complex surgical procedure.</p>
      <span class="ftag2 ftag2-r">High Risk · Rule-Based Detection</span>
      <div class="fdtl"><p><strong>Detection method:</strong> Our engine compares billed procedure codes against the patient's clinical documentation, length of stay, and PMJAY benchmark rates. Statistical anomalies trigger a flag.</p></div>
    </div>
    <div class="fc">
      <div class="fico fi-c">👻</div>
      <h3>Ghost Billing</h3>
      <p class="fcp">Claims submitted for services or treatments that were never rendered to the patient — phantom procedures billed against real patient IDs.</p>
      <span class="ftag2 ftag2-c">Critical · Pattern Detection</span>
      <div class="fdtl"><p><strong>Detection method:</strong> Cross-referencing admission dates, discharge summaries, and procedure timestamps with billing records. Short stays with disproportionately high bills are flagged.</p></div>
    </div>
    <div class="fc">
      <div class="fico fi-a">♊</div>
      <h3>Duplicate Submissions</h3>
      <p class="fcp">The same claim submitted multiple times for the same patient and procedure — either across hospitals or within the same facility within a short window.</p>
      <span class="ftag2 ftag2-a">Medium Risk · Deduplication</span>
      <div class="fdtl"><p><strong>Detection method:</strong> Patient ID, procedure code, and date proximity matching across our entire claims database flags near-identical submissions within a 7-day window.</p></div>
    </div>
  </div>
</section>

<!-- PLATFORM TABS -->
<section class="plat" id="platform">
  <div class="shdr">
    <div class="stag stag-b">🔬 The Platform</div>
    <h2 class="sh2">End-to-End Fraud Prevention Lifecycle</h2>
    <p class="spp">From claim ingestion to final audit report — our platform covers every stage of the fraud detection process.</p>
  </div>
  <div class="tabbar">
    <button class="tbb act" onclick="switchTab(0,this)">🔍 Detect Fraud</button>
    <button class="tbb" onclick="switchTab(1,this)">📊 Identify Patterns</button>
    <button class="tbb" onclick="switchTab(2,this)">📋 Audit &amp; Report</button>
  </div>
  <div class="tbc act" id="tab0">
    <div class="tibx">🔍</div>
    <div class="ttxt">
      <h3>Detect Fraud in Real-Time</h3>
      <p>Every claim submitted to PMJAY is instantly analyzed by our multi-layer rule engine and statistical models to identify suspicious patterns before payments are released.</p>
      <ul class="tlist">
        <li>Instant scoring of every incoming claim (0–100 fraud score)</li>
        <li>Cross-validation against PMJAY benchmark procedure rates</li>
        <li>Behavioral profiling of hospitals over rolling 30-day windows</li>
        <li>Automatic escalation for claims above threshold scores</li>
      </ul>
    </div>
  </div>
  <div class="tbc" id="tab1">
    <div class="tibx">📊</div>
    <div class="ttxt">
      <h3>Identify Fraud Patterns</h3>
      <p>Our analytics engine aggregates claim data to surface hidden fraud networks, habitual over-billers, and systemic abuse patterns across hospitals and regions.</p>
      <ul class="tlist">
        <li>Hospital-level fraud score ranking and trend tracking</li>
        <li>Procedure anomaly heatmaps by diagnosis category</li>
        <li>Network analysis to detect coordinated fraud rings</li>
        <li>Statistical outlier detection using peer-benchmark comparison</li>
      </ul>
    </div>
  </div>
  <div class="tbc" id="tab2">
    <div class="tibx">📋</div>
    <div class="ttxt">
      <h3>Audit &amp; Report</h3>
      <p>Generate comprehensive audit reports for investigators and government auditors with AI-narrated summaries and exportable data for legal proceedings.</p>
      <ul class="tlist">
        <li>AI-generated narrative audit summaries for each flagged claim</li>
        <li>One-click CSV export for investigative use</li>
        <li>Chain-of-evidence documentation for each flag</li>
        <li>Ministry-ready compliance reporting templates</li>
      </ul>
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section class="how" id="how-it-works">
  <div class="shdr">
    <div class="stag stag-b">⚙️ The Process</div>
    <h2 class="sh2">How AB-FDA Works</h2>
    <p class="spp">A four-stage automated pipeline that goes from raw claim submission to actionable fraud intelligence.</p>
  </div>
  <div class="howgrid">
    <div class="step">
      <div class="stepn">1</div>
      <span class="stepi">📥</span>
      <h4>Claim Ingestion</h4>
      <p>Hospital submits claim data to PMJAY portal. AB-FDA receives the data via Firebase real-time database with full claim metadata.</p>
    </div>
    <div class="step">
      <div class="stepn">2</div>
      <span class="stepi">🤖</span>
      <h4>AI Scanning</h4>
      <p>Multi-layer rule engine analyzes the claim against 15+ fraud indicators including benchmark deviation, stay duration, and diagnosis consistency.</p>
    </div>
    <div class="step">
      <div class="stepn">3</div>
      <span class="stepi">🎯</span>
      <h4>Scoring &amp; Flagging</h4>
      <p>Each claim receives a fraud score (0–100). Claims above threshold are flagged as HIGH, MEDIUM, or LOW risk with a specific fraud type assigned.</p>
    </div>
    <div class="step">
      <div class="stepn">4</div>
      <span class="stepi">📋</span>
      <h4>Audit Report</h4>
      <p>AI generates a narrative summary report. Investigators review the dashboard, drill into flagged claims, and export data for legal action.</p>
    </div>
  </div>
</section>

<!-- LIVE DASHBOARD -->
<section id="dashboard">
  <div class="dashi">
    <div class="stag stag-o">📊 Live Intelligence</div>
    <h2 class="sh2">Real-Time Fraud Detection Dashboard</h2>
    <p class="spp">Live data from Firebase — flagged claims updated in real time. Run the AI agent to generate a fresh audit report.</p>
  </div>
  <div class="dashbar">
    <div class="dashbar-l">
      <div class="nmark" style="width:32px;height:32px;font-size:11px;border-radius:8px">AB</div>
      <div><div style="font-family:'Epilogue',sans-serif;font-weight:800;font-size:.88rem;color:var(--text)">Claims Audit Dashboard</div><div style="font-size:.6rem;color:var(--mu);text-transform:uppercase;letter-spacing:.08em">Ayushman Bharat · PMJAY</div></div>
      <div class="lpill"><span class="ldot"></span>Live Monitoring</div>
    </div>
    <div class="dashbar-r">
      <button class="export-btn" onclick="exportCSV()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Export CSV
      </button>
      <button class="run-btn" id="runBtn" onclick="runAgent()">
        <svg class="run-arrow" width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        <div class="run-spin"></div>
        <span id="runLbl">Run Agent</span>
      </button>
    </div>
  </div>
  <div class="dwrap">
    <!-- ALERT -->
    <div class="alert-banner">
      <div class="alert-icon">⚠️</div>
      <div class="alert-body"><strong>High-Priority Alert:</strong> Fraud detection agent has flagged <strong id="flagCount">0</strong> suspicious claims in the last scan. Multiple hospitals exceed the critical fraud threshold. Immediate investigation recommended.</div>
      <div class="alert-right"><div class="alert-num" id="alertCount">0</div><div class="alert-num-lbl">Flags Raised</div></div>
    </div>
    <!-- KPIs -->
    <div class="kpi-grid">
      <div class="kpi ko" style="animation-delay:.0s">
        <div class="kpi-icon"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="var(--or2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></div>
        <div class="kpi-lbl">Claims Scanned</div><div class="kpi-val" id="kpi1">0</div>
        <div class="kpi-sub"><span class="kpi-sub-dot" style="background:var(--or2)"></span>Last agent batch · auto-refresh</div>
      </div>
      <div class="kpi kr" style="animation-delay:.07s">
        <div class="kpi-icon"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
        <div class="kpi-lbl">Fraud Flags</div><div class="kpi-val" id="kpi2">0</div>
        <div class="kpi-sub"><span class="kpi-sub-dot" style="background:var(--red)"></span>Rate: <span id="fraudRate">0%</span></div>
      </div>
      <div class="kpi ky" style="animation-delay:.14s">
        <div class="kpi-icon"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="var(--amber)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
        <div class="kpi-lbl">Est. Exposure</div><div class="kpi-val" id="kpi3">₹0L</div>
        <div class="kpi-sub"><span class="kpi-sub-dot" style="background:var(--amber)"></span>Across all flagged claims</div>
      </div>
      <div class="kpi kg" style="animation-delay:.21s">
        <div class="kpi-icon"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
        <div class="kpi-lbl">Hospitals Monitored</div><div class="kpi-val" id="kpi4">0</div>
        <div class="kpi-sub"><span class="kpi-sub-dot" style="background:var(--green)"></span>Critical &amp; moderate risk</div>
      </div>
    </div>
    <!-- CHARTS ROW -->
    <div class="section-lbl">Analytics Overview</div>
    <div class="g2">
      <div class="card" style="animation-delay:.05s"><div class="card-glow"></div><div class="card-hdr"><div class="card-title">Fraud Score — Top Claims</div><span class="cbadge cb-r">Score Distribution</span></div><canvas id="trendChart"></canvas></div>
      <div class="card" style="animation-delay:.1s"><div class="card-glow"></div><div class="card-hdr"><div class="card-title">Fraud Type Breakdown</div><span class="cbadge cb-o">Donut View</span></div><canvas id="donutChart"></canvas></div>
    </div>
    <!-- 3-COL ROW -->
    <div class="g3">
      <div class="card" style="animation-delay:.08s">
        <div class="card-glow"></div>
        <div class="card-hdr"><div class="card-title">Anomaly Type Analysis</div><span class="cbadge cb-a">Rule Engine</span></div>
        <div class="anom-rows">
          <div class="arow"><span class="arow-lbl">🔺 Up-coding</span><div class="arow-track"><div class="arow-fill af-upc" id="bar-upc" style="width:0%"></div></div><span class="arow-count" id="cnt-upc" style="color:var(--red)">0</span></div>
          <div class="arow"><span class="arow-lbl">👻 Ghost Billing</span><div class="arow-track"><div class="arow-fill af-ghost" id="bar-ghost" style="width:0%"></div></div><span class="arow-count" id="cnt-ghost" style="color:var(--cyan)">0</span></div>
          <div class="arow"><span class="arow-lbl">♊ Duplicate</span><div class="arow-track"><div class="arow-fill af-dup" id="bar-dup" style="width:0%"></div></div><span class="arow-count" id="cnt-dup" style="color:var(--amber)">0</span></div>
          <div class="arow"><span class="arow-lbl" style="color:var(--mu)">📊 Avg Score</span><div class="arow-track"><div class="arow-fill af-avg" id="bar-avg" style="width:0%"></div></div><span class="arow-count" id="cnt-avg" style="color:var(--green)">0</span></div>
        </div>
        <div class="ml-block"><div class="ml-score" id="mlConf">0%</div><div><div class="ml-lbl">ML Confidence (Sim)</div><div class="ml-sub">Rule engine + statistics</div></div></div>
      </div>
      <div class="card" style="animation-delay:.13s">
        <div class="card-hdr"><div class="card-title">Top Risk Hospitals</div><span class="cbadge cb-r">Ranked</span></div>
        <div class="hosp-list" id="hospList"><div class="empty"><div class="empty-icon">🏥</div><p>No data yet</p></div></div>
      </div>
      <div class="card" style="animation-delay:.18s">
        <div class="card-glow"></div>
        <div class="card-hdr"><div class="card-title">Procedure Anomalies</div><span class="cbadge cb-a">Diagnosis</span></div>
        <canvas id="barChart"></canvas>
      </div>
    </div>
    <!-- AI PANEL -->
    <div class="section-lbl">Audit Intelligence</div>
    <div class="ai-panel">
      <div class="ai-hdr"><div class="ai-chip"><div class="ai-chip-dot"></div>AI Risk Summary</div><div class="ai-title">Rules-Based Audit Report</div></div>
      <div class="report-block" id="aiReport">Awaiting agent scan… Click <strong style="color:var(--or2)">Run Agent</strong> to generate a rules-based audit summary.</div>
      <div class="ai-meta"><span>📊 Claims analyzed: <strong id="rmClaims">—</strong></span><span>🕐 Generated: <strong id="rmTime">—</strong></span><span>🎯 Confidence: <strong id="rmConf">—</strong></span></div>
    </div>
    <!-- TABLE -->
    <div class="section-lbl">Flagged Claims Detail</div>
    <div class="card" style="animation-delay:.1s">
      <div class="card-hdr"><div class="card-title">Claims Investigation Table</div><span class="cbadge cb-r" id="tblCount">— Records</span></div>
      <div class="filter-bar">
        <button class="flt fa" onclick="filterTable('ALL',this)">All</button>
        <button class="flt fr" onclick="filterTable('HIGH',this)">🔴 High Risk</button>
        <button class="flt fw" onclick="filterTable('MEDIUM',this)">🟡 Medium</button>
        <button class="flt" onclick="filterTable('ghost',this)">👻 Ghost</button>
        <button class="flt" onclick="filterTable('upcode',this)">🔺 Up-coding</button>
        <button class="flt" onclick="filterTable('dup',this)">♊ Duplicate</button>
        <button class="flt fg" onclick="filterTable('clean',this)">✅ Clean</button>
        <div class="search-box"><span class="search-icon">🔎</span><input type="text" id="searchInp" placeholder="Search claim / hospital…" oninput="applySearch()"></div>
      </div>
      <div class="tbl-wrap">
        <table>
          <thead><tr>
            <th onclick="sortTable('id')">Claim ID</th>
            <th onclick="sortTable('hosp')">Hospital</th>
            <th>Patient ID</th><th>Diagnosis / Proc.</th>
            <th onclick="sortTable('claimed')">Claimed</th>
            <th>Benchmark</th><th>Type</th>
            <th onclick="sortTable('score')">Score</th>
            <th onclick="sortTable('risk')">Risk</th><th></th>
          </tr></thead>
          <tbody id="claimsBody">
            <tr><td colspan="10"><div class="empty"><div class="empty-icon">🔍</div><h3>No data loaded</h3><p>Click <strong style="color:var(--or2)">Run Agent</strong> or wait for Firebase to load.</p></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="ffgrid">
    <div class="ffbrand">
      <div class="nmark">AB</div>
      <p>Ayushman Bharat Fraud Detection Agent (AB-FDA) — An AI-powered platform to protect PMJAY funds and ensure healthcare benefits reach genuine beneficiaries across India.</p>
    </div>
    <div class="fcol">
      <h4>Platform</h4>
      <a href="#platform">Fraud Detection</a>
      <a href="#platform">Pattern Analysis</a>
      <a href="#platform">Audit Reports</a>
      <a href="#dashboard">Live Dashboard</a>
    </div>
    <div class="fcol">
      <h4>Fraud Types</h4>
      <a href="#fraud-types">Up-coding</a>
      <a href="#fraud-types">Ghost Billing</a>
      <a href="#fraud-types">Duplicate Claims</a>
      <a href="#how-it-works">Detection Process</a>
    </div>
    <div class="fcol">
      <h4>Resources</h4>
      <a href="https://www.pmjay.gov.in" target="_blank">PMJAY Portal</a>
      <a href="https://nhp.gov.in" target="_blank">National Health Authority</a>
      <a href="#dashboard">Run Fraud Scan</a>
      <a href="#" onclick="exportCSV()">Export Data (CSV)</a>
    </div>
  </div>
  <div class="fbot">
    <p>© 2025 AB-FDA · Ayushman Bharat Fraud Detection Agent · Ministry of Health &amp; Family Welfare, Govt. of India</p>
    <div class="fbadges">
      <span class="fbdg">PMJAY · Confidential</span>
      <span class="fbdg">Engine v2.4.1</span>
      <span class="fbdg">🟢 Operational</span>
    </div>
  </div>
</footer>

<!-- MODAL -->
<div class="modal-ov" id="modal" onclick="handleOvClick(event)">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">✕</button>
    <div class="modal-id" id="mId">—</div>
    <div class="modal-hosp" id="mHosp">—</div>
    <div class="m-grid" id="mGrid"></div>
    <div class="modal-reason" id="mReason"></div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
// ── Tab Switcher ──────────────────────────────────
function switchTab(idx, btn) {
  document.querySelectorAll('.tbb').forEach(b => b.classList.remove('act'));
  btn.classList.add('act');
  document.querySelectorAll('.tbc').forEach((t, i) => {
    t.classList.toggle('act', i === idx);
  });
}

// ── Clock ──────────────────────────────────────
function updateClock() {
  const t = new Date().toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata', hour12: false }) + ' IST';
  ['clock'].forEach(id => { const el = document.getElementById(id); if(el) el.textContent = t; });
}
updateClock();
setInterval(updateClock, 1000);

// ── State ──────────────────────────────────────
let CLAIMS = [], HOSPITALS = [], filteredRows = [];
let sortKey = '', sortDir = 1, activeFilter = 'ALL';
let tChart, dChart, bChart;

// ── Firebase ───────────────────────────────────
async function loadFirestore() {
  setP(10);
  const cSnap = await db.collection("claims").get();
  const raw = []; cSnap.forEach(d => raw.push({ id: d.id, ...d.data() }));
  setP(45);
  const fSnap = await db.collection("fraud_flags").get();
  const fmap = {}; fSnap.forEach(d => { fmap[d.id] = d.data(); });
  setP(72);

  CLAIMS = raw.filter(c => fmap[c.id]).map(c => {
    const f = fmap[c.id], score = f.fraudScore || 0;
    return {
      id: c.id,
      hosp: c.hospitalName || c.hospital || "Unknown Hospital",
      pid: c.patientId || "PT-NA",
      proc: c.diagnosis || c.icdCode || (f.reasonSummary || "Flagged"),
      claimed: c.billedAmount || 0,
      bench: c.benchmarkAmount || c.billedAmount || 0,
      type: f.isUpcoding ? "upcode" : f.isGhost ? "ghost" : f.isDuplicate ? "dup" : "clean",
      score, risk: score >= 80 ? "HIGH" : score >= 50 ? "MEDIUM" : "LOW",
      reason: f.reasonSummary || ""
    };
  });

  const hs = {};
  CLAIMS.forEach(c => {
    if (!hs[c.hosp]) hs[c.hosp] = { cnt: 0, tot: 0 };
    hs[c.hosp].cnt++; hs[c.hosp].tot += c.score;
  });
  HOSPITALS = Object.entries(hs)
    .map(([name, v]) => { const a = v.tot / v.cnt; return { name, score: Math.round(a), risk: a >= 75 ? "high" : a >= 50 ? "med" : "low" }; })
    .sort((a, b) => b.score - a.score).slice(0, 7);

  updateKPIs(raw.length);
  updateBars();
  renderHospitals();
  setP(100); setTimeout(() => setP(0), 700);
}

function updateKPIs(total) {
  const f = CLAIMS.length;
  const exposure = CLAIMS.reduce((s, c) => s + (Number(c.claimed) || 0), 0);
  animNum("kpi1", 0, total);
  animNum("kpi2", 0, f);
  animNum("flagCount", 0, f);
  animNum("alertCount", 0, f);
  document.getElementById("fraudRate").textContent = total ? ((f / total) * 100).toFixed(1) + "%" : "0%";
  document.getElementById("kpi3").textContent = "₹" + ((Number(exposure) || 0) / 1e7).toFixed(2) + "Cr";
  animNum("kpi4", 0, HOSPITALS.length);
  document.getElementById("rmClaims").textContent = total || "0";
  document.getElementById("rmConf").textContent = f ? "92.0%" : "—";
}

function updateBars() {
  const upc = CLAIMS.filter(c => c.type === "upcode").length;
  const ghost = CLAIMS.filter(c => c.type === "ghost").length;
  const dup = CLAIMS.filter(c => c.type === "dup").length;
  const tot = upc + ghost + dup || 1;
  const avg = CLAIMS.length ? Math.round(CLAIMS.reduce((s, c) => s + c.score, 0) / CLAIMS.length) : 0;
  document.getElementById('cnt-upc').textContent = upc;
  document.getElementById('cnt-ghost').textContent = ghost;
  document.getElementById('cnt-dup').textContent = dup;
  document.getElementById('cnt-avg').textContent = avg;
  setTimeout(() => {
    document.getElementById('bar-upc').style.width = (upc / tot * 100) + '%';
    document.getElementById('bar-ghost').style.width = (ghost / tot * 100) + '%';
    document.getElementById('bar-dup').style.width = (dup / tot * 100) + '%';
    document.getElementById('bar-avg').style.width = avg + '%';
  }, 200);
  document.getElementById('mlConf').textContent = CLAIMS.length ? '92.0%' : '0%';
}

function renderHospitals() {
  const el = document.getElementById('hospList');
  if (!HOSPITALS.length) { el.innerHTML = '<div class="empty"><div class="empty-icon">🏥</div><p>No hospitals yet</p></div>'; return; }
  el.innerHTML = HOSPITALS.map((h, i) => `
    <div class="hosp-item hi-${h.risk}" onclick="filterByHospital('${h.name.replace(/'/g, "\\'")}')">
      <span class="hosp-rank">#${i + 1}</span>
      <span class="hosp-name">${h.name}</span>
      <span class="hosp-score hs-${h.risk}">${h.score}</span>
    </div>`).join('');
}

function filterByHospital(name) {
  filteredRows = CLAIMS.filter(c => c.hosp === name);
  renderTable(filteredRows);
  document.querySelectorAll('.flt').forEach(b => b.className = 'flt');
  showToast('🏥 Filtered: ' + name);
}

// ── Charts ─────────────────────────────────────
function initCharts() {
  Chart.defaults.color = '#6B7A99';
  Chart.defaults.borderColor = '#DDE2ED';
  const tCtx = document.getElementById('trendChart').getContext('2d');
  const sorted = [...CLAIMS].sort((a, b) => b.score - a.score).slice(0, 25);
  if (tChart) tChart.destroy();
  tChart = new Chart(tCtx, {
    type: 'bar',
    data: {
      labels: sorted.map(c => c.id),
      datasets: [{ label: 'Fraud Score', data: sorted.map(c => c.score),
        backgroundColor: sorted.map(c => c.score >= 80 ? 'rgba(255,61,107,0.75)' : c.score >= 50 ? 'rgba(255,184,0,0.75)' : 'rgba(0,214,143,0.65)'),
        borderRadius: 5, borderSkipped: false }]
    },
    options: { responsive: true, maintainAspectRatio: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { display: false }, ticks: { display: false } },
        y: { grid: { color: 'rgba(200,208,224,0.6)' }, max: 100, ticks: { color: '#6B7A99' } }
      }, animation: { duration: 1000, easing: 'easeOutQuart' } }
  });
  const dCtx = document.getElementById('donutChart').getContext('2d');
  const upc = CLAIMS.filter(c => c.type === "upcode").length;
  const ghost = CLAIMS.filter(c => c.type === "ghost").length;
  const dup = CLAIMS.filter(c => c.type === "dup").length;
  const clean = CLAIMS.filter(c => c.type === "clean").length;
  if (dChart) dChart.destroy();
  dChart = new Chart(dCtx, {
    type: 'doughnut',
    data: {
      labels: ['Up-coding', 'Ghost Billing', 'Duplicate', 'Clean'],
      datasets: [{ data: [upc, ghost, dup, clean],
        backgroundColor: ['rgba(255,61,107,0.82)', 'rgba(0,200,255,0.75)', 'rgba(255,184,0,0.82)', 'rgba(0,214,143,0.72)'],
        borderColor: '#FFFFFF', borderWidth: 3, hoverOffset: 10 }]
    },
    options: { responsive: true, cutout: '65%',
      plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, padding: 14, font: { size: 10 } } } },
      animation: { animateRotate: true, duration: 1000 } }
  });
  const bCtx = document.getElementById('barChart').getContext('2d');
  const byD = {}; CLAIMS.forEach(c => { byD[c.proc] = (byD[c.proc] || 0) + 1; });
  const top = Object.entries(byD).sort((a, b) => b[1] - a[1]).slice(0, 6);
  if (bChart) bChart.destroy();
  bChart = new Chart(bCtx, {
    type: 'bar',
    data: {
      labels: top.map(([k]) => k.length > 18 ? k.slice(0, 18) + '…' : k),
      datasets: [{ label: 'Flags', data: top.map(([, v]) => v),
        backgroundColor: ['rgba(255,87,34,0.8)', 'rgba(0,200,255,0.7)', 'rgba(255,184,0,0.8)', 'rgba(0,214,143,0.7)', 'rgba(255,61,107,0.7)', 'rgba(255,87,34,0.5)'],
        borderRadius: 5, borderSkipped: false }]
    },
    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { color: 'rgba(200,208,224,0.6)' }, ticks: { color: '#6B7A99' } },
        y: { grid: { display: false }, ticks: { color: '#6B7A99', font: { size: 10 } } }
      }, animation: { duration: 1000 } }
  });
}

// ── Table ──────────────────────────────────────
function populateTable() { filteredRows = [...CLAIMS]; renderTable(filteredRows); }

function renderTable(data) {
  const body = document.getElementById('claimsBody');
  document.getElementById('tblCount').textContent = data.length + ' Records';
  if (!data.length) {
    body.innerHTML = '<tr><td colspan="10"><div class="empty"><div class="empty-icon">🔎</div><h3>No results</h3><p>Try a different filter.</p></div></td></tr>';
    return;
  }
  const tmap = {
    upcode: '<span class="ftag ft-upc">🔺 Up-coding</span>',
    ghost: '<span class="ftag ft-ghost">👻 Ghost</span>',
    dup: '<span class="ftag ft-dup">♊ Duplicate</span>',
    clean: '<span class="ftag ft-clean">✅ Clean</span>'
  };
  body.innerHTML = data.map((c, i) => {
    const col = c.score >= 80 ? 'var(--red)' : c.score >= 50 ? 'var(--amber)' : 'var(--green)';
    return `<tr style="animation-delay:${Math.min(i, 18) * 28}ms" onclick="openModal(${CLAIMS.indexOf(c)})">
      <td class="td-id">${c.id}</td>
      <td style="font-size:.78rem;font-weight:500">${c.hosp}</td>
      <td style="font-size:.72rem;color:var(--mu)">${c.pid}</td>
      <td style="font-size:.75rem;max-width:170px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.proc}</td>
      <td style="font-weight:600;font-size:.8rem;color:${c.claimed > c.bench ? 'var(--red)' : 'var(--text)'}">₹${c.claimed.toLocaleString('en-IN')}</td>
      <td style="font-size:.78rem;color:var(--mu)">₹${c.bench.toLocaleString('en-IN')}</td>
      <td>${tmap[c.type] || '—'}</td>
      <td><div class="sc-wrap"><div class="sc-track"><div class="sc-fill" style="width:${c.score}%;background:${col}"></div></div><span class="sc-num" style="color:${col}">${c.score}</span></div></td>
      <td><span class="risk r${c.risk[0]}">${c.risk}</span></td>
      <td><button class="dtl-btn" onclick="event.stopPropagation();openModal(${CLAIMS.indexOf(c)})">Detail</button></td>
    </tr>`;
  }).join('');
}

function filterTable(type, btn) {
  document.querySelectorAll('.flt').forEach(b => b.className = 'flt');
  const cls = type === 'HIGH' ? 'fr' : type === 'MEDIUM' ? 'fw' : type === 'clean' ? 'fg' : 'fa';
  btn.className = 'flt ' + cls;
  activeFilter = type; applySearch();
}

function applySearch() {
  const q = (document.getElementById('searchInp').value || '').toLowerCase();
  let rows = CLAIMS;
  if (activeFilter === 'HIGH') rows = rows.filter(c => c.risk === 'HIGH');
  else if (activeFilter === 'MEDIUM') rows = rows.filter(c => c.risk === 'MEDIUM');
  else if (['ghost', 'upcode', 'dup', 'clean'].includes(activeFilter)) rows = rows.filter(c => c.type === activeFilter);
  if (q) rows = rows.filter(c => c.id.toLowerCase().includes(q) || c.hosp.toLowerCase().includes(q));
  filteredRows = rows; renderTable(filteredRows);
}

function sortTable(key) {
  if (sortKey === key) sortDir *= -1; else { sortKey = key; sortDir = 1; }
  document.querySelectorAll('thead th').forEach(th => th.className = '');
  const idxMap = { id: 0, hosp: 1, claimed: 4, score: 7, risk: 8 };
  const th = document.querySelectorAll('thead th')[idxMap[key]];
  if (th) th.className = sortDir === 1 ? 'sa' : 'sd';
  filteredRows = [...filteredRows].sort((a, b) => {
    let av = a[key], bv = b[key];
    if (typeof av === 'string') { av = av.toLowerCase(); bv = bv.toLowerCase(); }
    return av < bv ? -sortDir : av > bv ? sortDir : 0;
  });
  renderTable(filteredRows);
}

// ── Modal ──────────────────────────────────────
function openModal(idx) {
  const c = CLAIMS[idx];
  document.getElementById('mId').textContent = c.id;
  document.getElementById('mHosp').textContent = c.hosp;
  const over = c.claimed > c.bench ? `₹${(c.claimed - c.bench).toLocaleString('en-IN')} (+${Math.round((c.claimed / c.bench - 1) * 100)}%)` : 'Within benchmark';
  const rCls = c.risk === 'HIGH' ? 'mf-r' : c.risk === 'MEDIUM' ? 'mf-a' : 'mf-g';
  document.getElementById('mGrid').innerHTML = [
    ['Patient ID', c.pid, ''], ['Diagnosis', c.proc, 'mf-c'],
    ['Claimed Amt', '₹' + c.claimed.toLocaleString('en-IN'), 'mf-r'],
    ['Benchmark', '₹' + c.bench.toLocaleString('en-IN'), ''],
    ['Overcharge', over, 'mf-a'], ['Fraud Score', c.score + '/100', 'mf-r'],
    ['Fraud Type', c.type, 'mf-o'], ['Risk Level', `<span class="risk r${c.risk[0]}">${c.risk}</span>`, '']
  ].map(([l, v, cls]) => `<div class="mf"><div class="mf-lbl">${l}</div><div class="mf-val ${cls}">${v}</div></div>`).join('');
  const desc = {
    upcode: 'Procedure billed at higher complexity than documented. Classic up-coding pattern detected by rule engine.',
    ghost: 'Very short inpatient stay with disproportionately high billed amount. Possible phantom / ghost billing.',
    dup: 'Same patient submitted a near-identical claim within 7 days. Duplicate submission risk flagged.',
    clean: 'No rule-engine anomaly detected for this claim at current thresholds.'
  };
  document.getElementById('mReason').innerHTML = `<strong>Rule Analysis:</strong> ${desc[c.type] || ''}<br><br><strong>Reason Detail:</strong> ${c.reason || 'Flagged by detection engine.'}`;
  document.getElementById('modal').classList.add('open');
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
function handleOvClick(e) { if (e.target === e.currentTarget) closeModal(); }

// ── AI Report ──────────────────────────────────
function typeReport(text) {
  const el = document.getElementById('aiReport');
  el.innerHTML = ''; el.classList.add('typing');
  const html = text.replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--text)">$1</strong>')
    .replace(/\n\n/g, '<br><br>').replace(/\n/g, '<br>');
  const chars = [...html]; let i = 0, out = '';
  const t = setInterval(() => {
    out += chars[i] || ''; el.innerHTML = out; i++;
    if (i >= chars.length) { clearInterval(t); el.classList.remove('typing'); }
  }, 5);
}

// ── Run Agent ──────────────────────────────────
let running = false;
function runAgent() {
  if (running) return; running = true;
  const btn = document.getElementById('runBtn');
  btn.classList.add('running');
  document.getElementById('runLbl').textContent = 'Scanning…';
  setP(20);
  const f = CLAIMS.length, upc = CLAIMS.filter(c => c.type === "upcode").length;
  const ghost = CLAIMS.filter(c => c.type === "ghost").length, dup = CLAIMS.filter(c => c.type === "dup").length;
  const total = Number(document.getElementById('kpi1').textContent.replace(/,/g, '')) || f;
  const exp = CLAIMS.reduce((s, c) => s + (c.claimed || 0), 0);
  const avg = f ? Math.round(CLAIMS.reduce((s, c) => s + c.score, 0) / f) : 0;
  setTimeout(() => setP(65), 500);
  setTimeout(() => {
    animNum('flagCount', 0, f); animNum('alertCount', 0, f);
    setP(100);
    typeReport(
      `**Fraud Scan Complete — ${f} / ${total} claims flagged**\n\nUp-coding: ${upc} cases. Ghost / phantom billing: ${ghost} cases. Duplicate submissions: ${dup} cases.\n\nEstimated financial exposure across flagged claims: ₹${(exp / 1e5).toFixed(1)}L with average fraud score ${avg}/100.\n\n**Recommendation:** Prioritise audit for the top ${Math.min(3, HOSPITALS.length)} hospitals by average fraud score. Enable secondary clinical review for all claims above ₹1L originating from high-risk facilities.`
    );
    document.getElementById('rmTime').textContent = new Date().toLocaleTimeString('en-IN', { timeZone: 'Asia/Kolkata' });
    btn.classList.remove('running');
    document.getElementById('runLbl').textContent = 'Run Agent';
    running = false;
    showToast('✅ Scan complete — ' + f + ' flags generated');
    setTimeout(() => setP(0), 700);
  }, 1500);
}

// ── Utilities ──────────────────────────────────
function animNum(id, from, to) {
  const el = document.getElementById(id); if (!el) return;
  const start = performance.now(), dur = 900;
  function step(now) {
    const p = Math.min((now - start) / dur, 1), e = 1 - Math.pow(1 - p, 3);
    el.textContent = Math.round(from + (to - from) * e).toLocaleString('en-IN');
    if (p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}
function setP(pct) { document.getElementById('progress').style.width = pct + '%'; }
function showToast(msg) {
  const t = document.getElementById('toast');
  t.innerHTML = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}
function exportCSV() {
  if (!CLAIMS.length) { showToast('⚠️ No data to export. Run agent first.'); return; }
  const hdr = ['Claim ID', 'Hospital', 'Patient ID', 'Diagnosis', 'Claimed', 'Benchmark', 'Type', 'Score', 'Risk'];
  const rows = CLAIMS.map(c => [c.id, c.hosp, c.pid, c.proc, c.claimed, c.bench, c.type, c.score, c.risk].map(v => '"' + String(v).replace(/"/g, '""') + '"').join(','));
  const csv = [hdr.join(','), ...rows].join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = 'ab-fda-claims-' + new Date().toISOString().slice(0, 10) + '.csv';
  a.click();
  showToast('📥 Exported ' + CLAIMS.length + ' records as CSV');
}

// ── Init ───────────────────────────────────────
window.addEventListener('load', async () => {
  await loadFirestore();
  initCharts();
  populateTable();
  showToast('🛡️ AB-FDA Dashboard loaded');
});
</script>
</body>
</html>
